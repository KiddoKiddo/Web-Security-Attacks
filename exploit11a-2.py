#!/usr/bin/python
import mysql.connector
from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.alert import Alert
#from selenium import JavascriptExecutor

db = mysql.connector.connect(host="localhost", # your host, usually localhost
                     user="cs5331", # your username
                      passwd="v29AcujVSDKWadxe", # your password
                      db="cs5331")
                       # name of the data base

# you must create a Cursor object. It will let
#  you execute all the queries you need
cur = db.cursor() 

# Use all the SQL you like
query = ("SELECT password FROM table20 WHERE username= %s")
adm="admin"
cur.execute(query, (adm,))

# print all the first cell of all the rows
for row in cur.fetchall() :
    passwd= row[0]


driver = webdriver.Firefox()
url1 = "http://www.wsb.com/Assignment2/case20/login.php"
driver.get(url1)
nameele = driver.find_element_by_name("email")
nameele.send_keys("admin@admin.com")
passele = driver.find_element_by_id("password")
passele.send_keys(passwd)

inp_elems = driver.find_elements_by_tag_name('input')
for i in inp_elems:
	if ((i.get_attribute('type') == 'button') & (i.get_attribute('value') == 'Login')):
		i.click()
		url2= driver.current_url
		if(url2 == url1):
			print "login attempt failed"
		else:
			driver.get(url2)
			scr = "alert('password=" + passwd + "');"
			driver.execute_script(scr)
			break;
